@using Bakim.Entity;
@using Bakim.ViewModels;

@model StockViewModel;


<div class="container">
    <div class="card card-flush shadow-sm">
        <form id="formid" asp-controller="Describing" asp-action="Stock" method="post" enctype="multipart/form-data">
            <div class="card-header">
                <h3 class="card-title">Stok Tanımlayın</h3>
            </div>
            <div class="card-body py-5">
                <div class="row">
                    <div class="col-md-6 mb-10">
                        <label for="exampleFormControlInput1" class="form-label">Stok Resmi</label>
                        <br>
                        <br>
                        <!--begin::Image input-->
                        <div class="image-input image-input-outline" data-kt-image-input="true"
                            style="background-image: url(/app/images/stocks)">
                            <!--begin::Image preview wrapper-->
                            <div class="image-input-wrapper w-125px h-125px"
                                style="background-image: url(/app/images/stocks)"></div>
                            <!--end::Image preview wrapper-->

                            <!--begin::Edit button-->
                            <label
                                class="btn btn-icon btn-circle btn-color-muted btn-active-color-primary w-25px h-25px bg-body shadow"
                                data-kt-image-input-action="change" data-bs-toggle="tooltip" data-bs-dismiss="click"
                                title="Change avatar">
                                <i class="bi bi-pencil-fill fs-7"></i>

                                <!--begin::Inputs-->
                                <input type="file" name="file" accept=".png, .jpg, .jpeg" style="object-fit:cover;" />
                                <input type="hidden" name="avatar_remove" />
                                <!--end::Inputs-->
                            </label>
                            <!--end::Edit button-->

                            <!--begin::Cancel button-->
                            <span
                                class="btn btn-icon btn-circle btn-color-muted btn-active-color-primary w-25px h-25px bg-body shadow"
                                data-kt-image-input-action="cancel" data-bs-toggle="tooltip" data-bs-dismiss="click"
                                title="Cancel avatar">
                                <i class="bi bi-x fs-2"></i>
                            </span>
                            <!--end::Cancel button-->

                            <!--begin::Remove button-->
                            <span
                                class="btn btn-icon btn-circle btn-color-muted btn-active-color-primary w-25px h-25px bg-body shadow"
                                data-kt-image-input-action="remove" data-bs-toggle="tooltip" data-bs-dismiss="click"
                                title="Remove avatar">
                                <i class="bi bi-x fs-2"></i>
                            </span>
                            <!--end::Remove button-->
                        </div>
                        <!--end::Image input-->
                    </div>

                    <div class="col-md-6 row">
                        <div class="col-md-12">
                            <label for="exampleFormControlInput1" class="required form-label">Stok Grubu</label>
                            <select required onchange="kategorigetir($(this).val())"
                                class="form-select form-select-sm form-select-solid" data-control="select2"
                                name="StockGroupId" data-placeholder="Stok Grubu Seçiniz">
                                <option></option>
                                @foreach (var item in Model.stockGrubu)
                                {
                                    <option value="@item.StockGroupId">@item.StockGroupName</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-12">
                            <label for="exampleFormControlInput1" class="required form-label">Stok Kategorisi</label>
                            <select required id="skategoriselect" class="form-select form-select-sm form-select-solid"
                                data-control="select2" name="StokKategoriId" data-placeholder="Kategori Seçiniz">
                                <option value=""></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Stok Kodu</label>
                            <input required type="text" class="form-control form-control-sm form-control-solid"
                                placeholder="Stok Kodu Yazınız" name="StockCode" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Stok Adı</label>
                            <input required type="text" class="form-control form-control-sm form-control-solid"
                                placeholder="Stok Adı Yazınız" name="StockName" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="form-label">Barkod</label>
                            <input type="text" class="form-control form-control-sm form-control-solid"
                                placeholder="Barkod Yazınız" name="Barcode" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="form-label">Ölçü</label>
                            <input type="text" class="form-control form-control-sm form-control-solid"
                                placeholder="Ölçü Yazınız" name="Olcu" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Fiyat</label>
                            <input required type="number" class="form-control form-control-sm form-control-solid"
                                placeholder="Fiyat Yazınız" name="Price" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Miktar</label>
                            <input required type="number" class="form-control form-control-sm form-control-solid"
                                placeholder="Stok Miktarı Yazınız" name="StockAmount" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Minimum Stok</label>
                            <input required type="number" class="form-control form-control-sm form-control-solid"
                                placeholder="Min Stok Yazınız" name="MinStock" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-10">
                            <label for="exampleFormControlInput1" class="required form-label">Maksimum Stok</label>
                            <input required type="number" class="form-control form-control-sm form-control-solid"
                                placeholder="Max Stok Yazınız" name="MaxStock" />
                        </div>
                    </div>
                    <div class="col-md-12">
                        <label for="exampleFormControlInput1" class="form-label">Tedarikçi Firma</label>
                        <select class="form-select form-select-sm form-select-solid" data-control="select2" multiple
                            name="firmalar" data-placeholder="Tedarikçi Firma Seçiniz">
                            <option value=""></option>
                            @foreach (var item in Model.tedarikciFirmalar)
                            {
                                <option value="@item.FirmaId">@item.FirmaAdi</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button id="formsubmitbtn" type="button" class="btn btn-primary mb-4" style="float: right;">Stok Ekle</button>
            </div>
        </form>
    </div>
</div>

<script>
    function kategorigetir(value) {
        $('#skategoriselect').html("");
        $.ajax({
            url: "/Describing/KategoriGetir",
            method: "GET",  // istek türü (GET veya POST)
            data: { getiren: value },  // gönderilecek veriler
            async: true,
            success: function (result) {
                console.log(result);
                let option = $('<option></option>');
                $('#skategoriselect').append(option);
                for (let item of result) {
                    $('#skategoriselect').append("<option value=" + item.StokKategoriId + ">" + item.StokKategoriName + "</option>");
                }
            }
        });
    }

    $(document).on('click','#formsubmitbtn', function(e){
        e.preventDefault();
        if(checkInputs("formid"))
            $('#formid').submit();
    });


    function checkInputs(formName) {
  const getform = "#" + formName;
  var result = true;
  $(getform)
    .find("input:required")
    .each(function () {
      if ($(this).val() === "") {
        result = false;
      }
    });
  $(getform)
    .find("select:required")
    .each(function () {
      if ($(this).val() === "") {
        result = false;
      }
    });
  $(getform)
    .find("textarea:required")
    .each(function () {
      if ($(this).val() === "") {
        result = false;
      }
    });
  if (result === false) {
    Swal.fire({
      text: "Zorunlu Alanları Doldurun.",
      icon: "error",
      timer: 1200,
      showConfirmButton: false,
    });
    return result;
  }
  return true;
}
</script>
